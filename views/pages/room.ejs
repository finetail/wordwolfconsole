<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<body>
  <div id="room_id" style="display:none;"><%= id %></div>
  <div id="room_name">部屋名：<%= room_name %>
  </div>
  <% if(master) { %>
    <div>あなたは部屋主です</div>
    <div>部屋に全員が入室したあと、お題を入力して実行してください。</div>
    <div>現在の状態：<span id="status"></span></div>
    <div id="message"></div>
    <div><input type="button" value="状態更新" id="get_status"></div>
    <div>
      <label>村人用のお題<input type="text" id="person" name="person" placeholder="村人用のお題"></label>
      <label>人狼用のお題<input type="text" id="wolf" name="wolf" placeholder="人狼用のお題"></label>
    </div>
    <div><input type="button" value="実行" id="send" name="send"></div>
    <div id="link"></div>
  <% } else { %>
    <div>名前を入力してください。</div>
    <div><label>名前<input type="text" id="user_name" name="user_name" placeholder="名前書いて"></label></div>
    <div><input type="button" value="参加" id="join" name="join"></div>
    <div><input type="button" value="ワード取得" id="get_my_word" name="get_my_word"></div>
    <div id="message"></div>
    <div id="link"></div>
  <% } %>
</body>
<script>
  const room_id = $("#room_id").text()
  let person_id = ""
  $("#link").text(window.location.href.replace(/&master_id.*/,''))
  $("#send").on("click",()=>{
    const person = $("#person").val()
    const wolf = $("#wolf").val()

    $.ajax({
      url:'send_question',
      type:'GET',
      dataType:'json',
      data:{id:room_id,person:person,wolf:wolf},
      timeout:10000
    }).done((data)=>{
      $("#message").text(data.message)
    }).fail(()=>{
      alert("エラーだわ")
    })
  })
  $("#get_status").on("click", ()=>{
    $.ajax({
      url:'get_status',
      type:'GET',
      dataType:'json',
      data:{id:room_id},
      timeout:10000
    }).done((data)=>{
      $("#status").text(data.message)
    }).fail(()=>{
      alert("エラーだわ")
    })
  })
  $("#get_my_word").on("click",()=>{
    $.ajax({
      url:'get_my_word',
      type:'GET',
      dataType:'json',
      data:{id:room_id,person_id:person_id},
      timeout:10000
    }).done((data)=>{
      $("#message").text(data.message)
    }).fail(()=>{
      alert("エラーだわ")
    })
  })
  $("#join").on("click",()=>{
    $.ajax({
      url:'join',
      type:'GET',
      dataType:'json',
      data:{id:room_id,name:$("#user_name").val()},
      timeout:10000
    }).done((data)=>{
      person_id = data.person_id
      console.log(`person_id:${person_id}`)
      $("#user_name").hide()
      $("#join").hide()
    }).fail(()=>{
      alert("エラーだわ")
    })
  })
</script>

</html>